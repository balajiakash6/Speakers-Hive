<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeakersHive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                'hive-yellow': '#FFD60A',
                'hive-black': '#121212',
                'hive-card': '#1E1E1E',
                'hive-input': '#09090b',
              },
              fontFamily: { sans: ['Inter', 'sans-serif'] }
            }
          }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #121212; color: white; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        .nav-link.active { background-color: rgba(0,0,0,0.1); font-weight: 800; border-right: 4px solid black; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="flex flex-col md:flex-row h-screen overflow-hidden">

<aside class="w-full md:w-64 bg-hive-yellow text-black flex flex-col z-50 shadow-2xl shrink-0 md:h-full transition-all duration-300">
    <div class="p-4 md:p-8 md:pb-6 flex items-center justify-between md:justify-start">
        <div class="flex items-center gap-3">
            <div class="bg-black p-2 rounded-lg text-hive-yellow shadow-sm transform -rotate-6">
                <i data-lucide="megaphone" class="w-5 h-5 md:w-6 md:h-6"></i>
            </div>
            <h1 class="text-xl md:text-2xl font-black tracking-tighter uppercase leading-none">SPEAKERS<br/>HIVE</h1>
        </div>
        <button class="md:hidden p-2 active:scale-95 transition" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
            <i data-lucide="menu" class="w-6 h-6"></i>
        </button>
    </div>

    <nav id="mobile-menu" class="hidden md:flex flex-col flex-1 px-4 space-y-2 pb-4 md:pb-0 md:mt-4 bg-hive-yellow w-full md:w-auto absolute md:relative top-[70px] md:top-0 left-0 shadow-xl md:shadow-none z-50 border-t md:border-t-0 border-black/10">
        <a href="/dashboard" th:classappend="${activeTab == 'dashboard' ? 'active' : ''}" class="nav-link flex items-center px-4 py-3 rounded-xl hover:bg-black/5 font-bold transition-all duration-200"><i data-lucide="layout-grid" class="w-5 h-5 mr-3"></i> Dashboard</a>
        <a href="/agenda" th:classappend="${activeTab == 'agenda' ? 'active' : ''}" class="nav-link flex items-center px-4 py-3 rounded-xl hover:bg-black/5 font-bold transition-all duration-200"><i data-lucide="calendar" class="w-5 h-5 mr-3"></i> Agenda</a>
        <a href="/reports" th:classappend="${activeTab == 'reports' ? 'active' : ''}" class="nav-link flex items-center px-4 py-3 rounded-xl hover:bg-black/5 font-bold transition-all duration-200"><i data-lucide="file-text" class="w-5 h-5 mr-3"></i> Reports</a>
    </nav>

    <div class="hidden md:block p-6 mt-auto space-y-4">
        <a href="/switch-mode" class="block w-full text-center bg-black/10 py-2 rounded-lg text-xs font-bold hover:bg-black/20 transition">
            <i data-lucide="refresh-cw" class="w-3 h-3 inline mr-1"></i> Switch Role
        </a>
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-black text-hive-yellow rounded-full flex items-center justify-center font-bold text-sm border-2 border-black">
                <span th:text="${#strings.substring(currentUser != null ? currentUser : 'U', 0, 1)}">U</span>
            </div>
            <div>
                <div class="font-bold text-sm" th:text="${currentUser}">User</div>
                <div class="text-[10px] font-bold opacity-60 uppercase" th:text="${currentRole != null ? currentRole : 'MEMBER'}">Member</div>
            </div>
        </div>
    </div>
</aside>

<main id="main-content" class="flex-1 overflow-y-auto overflow-x-hidden bg-hive-black relative w-full h-full no-scrollbar">
    <div class="p-4 md:p-10 max-w-7xl mx-auto fade-in pb-32">
        <div layout:fragment="content"></div>
    </div>
</main>

<script>
    lucide.createIcons();

    // ðŸ§  SMART SCROLL ENGINE
    document.addEventListener("DOMContentLoaded", function() {
        const mainContent = document.getElementById('main-content');
        const savedPos = sessionStorage.getItem("scrollPosition");
        if (savedPos) {
            mainContent.scrollTop = savedPos;
            sessionStorage.removeItem("scrollPosition");
        }
    });

    function saveScroll() {
        const mainContent = document.getElementById('main-content');
        sessionStorage.setItem("scrollPosition", mainContent.scrollTop);
    }
</script>
</body>
</html>